[workspace]
resolver = "2"
members = [".", "actors", "kameo_type_hash_macros", "macros"]

[workspace.dependencies]
kameo = { path = ".", version = "0.18.0" }

futures = "0.3"
tokio = "1.47"

[profile.release]
lto = true
opt-level = 3
codegen-units = 1

[package.metadata.docs.rs]
all-features = true

[package]
name = "kameo"
version = "0.18.0"
edition = "2021"
rust-version = "1.85.1"
description = "Fault-tolerant Async Actors Built on Tokio"
readme = "README.md"
repository = "https://github.com/tqwewe/kameo"
license = "MIT OR Apache-2.0"
keywords = ["actor", "tokio"]
categories = ["asynchronous", "concurrency", "rust-patterns"]
include = ["/src"]

[features]
default = ["macros", "tracing"]
macros = ["dep:kameo_macros"]
remote = [
  "dep:dashmap",
  "dep:either",
  "dep:kameo_remote",
  "dep:kameo_type_hash_macros",
  "dep:rkyv",
]
tracing = ["dep:tracing", "tokio/tracing"]
nightly = [] # Feature flag for nightly-only features

[dependencies]
kameo_macros = { version = "0.18.0", path = "./macros", optional = true }
kameo_type_hash_macros = { path = "./kameo_type_hash_macros", optional = true }

bitflags = "2.6"
bytes = "1.5"
dashmap = { version = "6.1", optional = true }
downcast-rs = "2.0.1"
dyn-clone = "1.0"
either = { version = "1.15.0", optional = true }
futures.workspace = true
kameo_remote = { path = "../kameo_remote", optional = true }
rkyv = { version = "0.8", features = ["bytecheck", "std"], optional = true }
# rmp-serde = { version = "1.3.0", optional = true }
# serde = { version = "1.0", features = ["derive"] }
thiserror = "2.0"
tokio = { workspace = true, features = [
  "macros",
  "rt",
  "sync",
  "time",
  "rt-multi-thread",
] }
tracing = { version = "0.1", optional = true }

[dev-dependencies]
criterion = { version = "0.7", features = ["async_tokio"] }
kameo_actors = { path = "actors" }
tokio = { version = "1", features = [
  "macros",
  "rt",
  "rt-multi-thread",
  "sync",
  "time",
] }
tokio-stream = { version = "0.1.15", features = ["time"] }
tokio-test = "0.4.4"
tracing-subscriber = { version = "0.3", features = ["env-filter"] }


[[example]]
name = "forward_with_fallback"
path = "examples/local/forward_with_fallback.rs"

[[example]]
name = "stream"
path = "examples/local/stream.rs"

[[example]]
name = "type_hash_demo"
path = "examples/remote/type_hash_demo.rs"
required-features = ["remote"]

[[example]]
name = "streaming_api_server"
path = "examples/remote/streaming_api_server.rs"
required-features = ["remote"]

[[example]]
name = "streaming_api_client"
path = "examples/remote/streaming_api_client.rs"
required-features = ["remote"]

[[example]]
name = "test_streaming_simple"
path = "examples/remote/test_streaming_simple.rs"
required-features = ["remote"]

[[example]]
name = "test_message_sizes"
path = "examples/remote/test_message_sizes.rs"
required-features = ["remote"]

[[example]]
name = "streaming_only_test"
path = "examples/remote/streaming_only_test.rs"
required-features = ["remote"]

[[example]]
name = "max_performance_test"
path = "examples/remote/max_performance_test.rs"
required-features = ["remote"]

[[example]]
name = "ask_concrete_client"
path = "examples/remote/ask_concrete_client.rs"
required-features = ["remote"]

[[example]]
name = "ask_concrete_client_zerocopy"
path = "examples/remote/ask_concrete_client_zerocopy.rs"
required-features = ["remote"]

[[example]]
name = "ask_concrete_server"
path = "examples/remote/ask_concrete_server.rs"
required-features = ["remote"]

[[example]]
name = "ask_generic_client"
path = "examples/remote/ask_generic_client.rs"
required-features = ["remote"]

[[example]]
name = "ask_generic_server"
path = "examples/remote/ask_generic_server.rs"
required-features = ["remote"]

[[example]]
name = "simple_streaming_test"
path = "examples/remote/simple_streaming_test.rs"
required-features = ["remote"]

[[example]]
name = "tell_concrete_client"
path = "examples/remote/tell_concrete_client.rs"
required-features = ["remote"]

[[example]]
name = "tell_concrete_server"
path = "examples/remote/tell_concrete_server.rs"
required-features = ["remote"]

[[example]]
name = "tell_generic_client"
path = "examples/remote/tell_generic_client.rs"
required-features = ["remote"]

[[example]]
name = "tell_generic_server"
path = "examples/remote/tell_generic_server.rs"
required-features = ["remote"]

[[example]]
name = "tell_messages"
path = "examples/remote/tell_messages.rs"
required-features = ["remote"]

[[example]]
name = "test_large_messages"
path = "examples/remote/test_large_messages.rs"
required-features = ["remote"]

[[example]]
name = "test_large_only"
path = "examples/remote/test_large_only.rs"
required-features = ["remote"]

[[example]]
name = "test_streaming_fix"
path = "examples/remote/test_streaming_fix.rs"
required-features = ["remote"]

[[example]]
name = "type_hash_compile_time_proof"
path = "examples/remote/type_hash_compile_time_proof.rs"
required-features = ["remote"]

[[example]]
name = "type_hash_const_proof"
path = "examples/remote/type_hash_const_proof.rs"
required-features = ["remote"]

[[example]]
name = "zero_alloc_demo"
path = "examples/remote/zero_alloc_demo.rs"
required-features = ["remote"]

[[example]]
name = "zero_copy_benchmark"
path = "examples/remote/zero_copy_benchmark.rs"
required-features = ["remote"]

[[example]]
name = "zero_copy_comparison_test"
path = "examples/remote/zero_copy_comparison_test.rs"
required-features = ["remote"]

[[example]]
name = "zero_copy_perf_test"
path = "examples/remote/zero_copy_perf_test.rs"
required-features = ["remote"]

[[example]]
name = "test_bidirectional_gossip"
path = "examples/remote/test_bidirectional_gossip.rs"
required-features = ["remote"]

[[bench]]
name = "overhead"
harness = false

[lints.rust]
unexpected_cfgs = { level = "warn", check-cfg = ['cfg(tokio_unstable)'] }
